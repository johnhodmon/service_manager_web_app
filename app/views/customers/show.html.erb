<% provide(:side_content, 'layouts/customers')%>  

<div class= "row ">
<div class="col-md-4">
<h1>Customer Details</h1>
<p>
<%= @customer.name %> <br>
<%= @customer.street %><br>
<%= @customer.town %><br>
<%= @customer.county %><br>
<%= @customer.phone %><br>
<%= @customer.email %><br>


</p>
<%= link_to "Edit this Customer", edit_customer_path(@customer) %>
<%= link_to 'Delete this Customer', @customer, method: :delete, data: { confirm: 'Are you sure you want to delete this customer?' } %>
</div>

<div class="col-md-4">
<h1>Customer Products</h1>
<ul >
<%  @customer.owned_products.each do |product| %>

<li><h3><%= link_to product.manufacturer.name+" "+
product.product_number, product_path(id:product.id) %></h3><p><%= link_to "Create Job for this Product", new_job_path(product_id:product.id,customer_id:@customer.id) %> </p></li> 
<% end %> 
</ul>
<h1>Add Product for this Customer</h1>
 <%= form_for(:customer_product, url:customer_path(customer_id:@customer.id)) do |f| %>
   

      <%= f.label :product_id,"Product" %>
       <%= f.select(:product_id, Product.all.collect{|p| [ p.manufacturer.name+" "+p.product_number, p.id ] }, {:include_blank => 'Select a Product'}) %>

        <%= f.hidden_field :customer_id, :value => @customer.id %>
        <%= f.label :serial_number %>
<%= f.text_field :serial_number %>
      

         

 <%= f.submit "Add Product" %>
 <% end %>

<h1> Invoices for this Customer</h1>
<ul >
<%  @customer.owned_products.each do |product|
 product.jobs.each do |job|
 	if(job.invoice!=nil) %>

<li><%= link_to job.invoice.created_at.strftime("%B %d, %Y")+" "+job.invoice.invoice_number,invoice_path(id:job.invoice.id)%></li> 
<% end %>
<% end %>
<% end %>
</ul>
</div>

<div class="col-md-4">
<h1>Jobs for this Customer</h1>
<ul >
<%  @customer.owned_products.each do |product|
 product.jobs.each do |job|%>

<li><%= link_to job.created_at.strftime("%B %d, %Y")+" "+job.reported_fault,job_path(id:job.id)%></li> 

<% end %>
<% end %> 
</ul>
</div>

</div>



